**Query #1**

    WITH DailyAmounts AS (
        SELECT
            CAST(tr.transaction_time AS DATE) AS transaction_date,
            AVG(tr.transaction_amount) AS avg_transaction_amount
        FROM transactions AS tr
        WHERE CAST(tr.transaction_time AS DATE) BETWEEN '2021-01-01' AND '2021-01-31'
        GROUP BY CAST(tr.transaction_time AS DATE)
    )
    SELECT
        transaction_date,
        avg_transaction_amount,
        AVG(avg_transaction_amount) OVER (
            ORDER BY transaction_date
            ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
        ) AS rolling_3_day_avg
    FROM DailyAmounts
    ORDER BY transaction_date;

| transaction_date | avg_transaction_amount | rolling_3_day_avg |
| ---------------- | ---------------------- | ----------------- |
| 2021-01-01       | 2139.4                 | 2139.4            |
| 2021-01-02       | 215.436666666667       | 1177.41833333333  |
| 2021-01-03       | 18.02                  | 790.952222222222  |
| 2021-01-04       | 321.29                 | 184.915555555556  |
| 2021-01-05       | 208.8875               | 182.7325          |
| 2021-01-06       | 111.15                 | 213.775833333333  |
| 2021-01-07       | 243.95                 | 187.995833333333  |
| 2021-01-08       | 86.85                  | 147.316666666667  |
| 2021-01-09       | 344.496666666667       | 225.098888888889  |
| 2021-01-10       | 250.583333333333       | 227.31            |
| 2021-01-11       | 575.985                | 390.355           |
| 2021-01-12       | 2614.645               | 1147.07111111111  |
| 2021-01-13       | 122.845                | 1104.49166666667  |
| 2021-01-14       | 253.2075               | 996.899166666667  |
| 2021-01-15       | 509.7725               | 295.275           |
| 2021-01-16       | 45.4766666666667       | 269.485555555556  |
| 2021-01-17       | 22.94                  | 192.729722222222  |
| 2021-01-18       | 276.715                | 115.043888888889  |
| 2021-01-19       | 93.19                  | 130.948333333333  |
| 2021-01-20       | 37.5025                | 135.8025          |
| 2021-01-21       | 125.194                | 85.2955           |
| 2021-01-22       | 131.75                 | 98.1488333333333  |
| 2021-01-23       | 408.973333333333       | 221.972444444444  |
| 2021-01-24       | 388.433333333333       | 309.718888888889  |
| 2021-01-25       | 72.7375                | 290.048055555556  |
| 2021-01-26       | 751.1175               | 404.096111111111  |
| 2021-01-27       | 117.835                | 313.896666666667  |
| 2021-01-28       | 2243.6025              | 1037.51833333333  |
| 2021-01-29       | 380.225                | 913.8875          |
| 2021-01-30       | 155.373333333333       | 926.400277777778  |
| 2021-01-31       | 19.81                  | 185.136111111111  |

---

[View on DB Fiddle](https://www.db-fiddle.com/f/fufVxMKne1xMNHCbFoANMo/0)
